{% set layout = "ClarolineCoreBundle:Workspace:layout.html.twig" %}

{% if isDesktop() %}
    {% set layout = "ClarolineCoreBundle:Desktop:layout.html.twig" %}
{% endif %}

{% extends layout %}

{% block javascripts %}
    <script src="{{ asset('bundles/clarolinescorm/js/scorm_api.js') }}" type="text/javascript"></script>
    {{ parent() }}
    <script type="text/javascript">
        function runPrefixedMethod(obj, method) {
            var pfx = ['webkit', 'moz', 'ms', 'o', ''];
            var p = 0, m = null, t = null;

            while (p < pfx.length && !obj[m]) {
                m = method;

                if (pfx[p] == '') {
                    m = m.substr(0,1).toLowerCase() + m.substr(1);
                }

                m = pfx[p] + m;

                if ('undefined' !== (t = typeof obj[m])) {
                    pfx = [pfx[p]];

                    return t === 'function' ? obj[m]() : obj[m];
                }

                p++;
            }
        }

        function enterFullScreen() {
            if (runPrefixedMethod(document, 'FullScreen') || runPrefixedMethod(document, 'IsFullScreen')) {
                runPrefixedMethod(document, 'CancelFullScreen');
            }
            else {
                runPrefixedMethod(document.getElementById('scorm-frame'), 'RequestFullScreen');
            }
        }
        
    </script>
{% endblock %}
    
{% block title %}{{ resource.getResourceNode().getName() ~ ' - ' ~ parent()|striptags|raw }}{% endblock %}

{% block section_content %}
    <div class="panel-heading">
        <h3 class="panel-title"> {{ resource.getResourceNode().getName() }} </h3>
    </div>
    <div class="panel-body">
        <div class="text-right">
            <a class="btn btn-primary pointer-hand" onClick="javascript:enterFullScreen()">
                <i class="icon-resize-full"></i>
            </a>
        </div>
        <div class="full-size">
            <div id="twig-scorm-data"
                 student-id="{{scormInfo.getUser().getId()}}"
                 scorm-id="{{scormInfo.getScorm().getId()}}"
                 student-name="{{scormInfo.getUser().getFirstName()}}, {{scormInfo.getUser().getLastName()}}"
                 scorm-id="{{scormInfo.getScorm().getId()}}"
                 score-raw="{% if scormInfo.getScoreRaw() > -1 %}{{scormInfo.getScoreRaw()}}{% endif %}"
                 score-min="{% if scormInfo.getScoreMin() > -1 %}{{scormInfo.getScoreMin()}}{% endif %}"
                 score-max="{% if scormInfo.getScoreMax() > -1 %}{{scormInfo.getScoreMax()}}{% endif %}"
                 total-time="{{scormInfo.getTotalTime()}}"
                 credit="{{scormInfo.getCredit()}}"
                 lesson-status="{{scormInfo.getLessonStatus()}}"
                 lesson-location="{{scormInfo.getLessonLocation()}}"
                 exit="{{scormInfo.getExitMode()}}"
                 entry="{{scormInfo.getEntry()}}"
                 lesson-mode=""{{scormInfo.getLessonMode()}}
                 suspend-data="{{scormInfo.getSuspendData()}}"
                 launch-data="{{ scormInfo.getScorm().getLaunchData()}}"
            >
            </div>
            <iframe id="scorm-frame"
                    overflow="visible"
                    class="full-size"
                    src="{{ asset( scormUrl ) }}"
                    frameborder="0">
            </iframe>
        </div>
    </div>
    <style>
        .full-size {
            height: 100%;
            width: 100%;
        }
    </style>
{% endblock %}
